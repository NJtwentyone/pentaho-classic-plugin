{"version":3,"file":"useHeaderGroups.js","sources":["../../../../src/Table/hooks/useHeaderGroups.ts"],"sourcesContent":["import { CSSProperties } from \"react\";\nimport { Hooks } from \"react-table\";\n\n// #region ##### TYPES #####\n\nexport interface UseHvHeaderGroupsInstance {\n  hasGroupedColumns?: boolean;\n}\n\n// props target: <table><thead><tr><th>\nexport interface UseHvHeaderGroupsColumnProps {\n  style?: CSSProperties;\n  groupColumnMostLeft?: boolean;\n  groupColumnMostRight?: boolean;\n}\n\n// props target: <table><tbody><tr><td>\nexport interface UseHvHeaderGroupsCellProps {\n  groupColumnMostLeft?: boolean;\n  groupColumnMostRight?: boolean;\n}\n\nexport type UseHvHeaderGroupsProps = (<\n  D extends object = Record<string, unknown>\n>(\n  hooks: Hooks<D>\n) => void) & { pluginName: string };\n\n// #endregion ##### TYPES #####\n\n/**\n * Moving non grouped headers to the top level,\n * by placing them in the position of their top level placeholder.\n *\n * By default the header groups are built bottom top,\n * that results in non grouped headers to be placed\n * at the bottom row in the table head.\n *\n * @param {Array.<Object>} headerGroups - table header groups\n */\nconst replaceHeaderPlaceholders = (headerGroups) => {\n  const [headerGroup] = headerGroups;\n\n  const hasPlaceholderHeaders = headerGroup.headers.some(\n    (h) => h.placeholderOf != null\n  );\n  if (!hasPlaceholderHeaders) {\n    return; // no placeholder header found to replace\n  }\n\n  const maxDepth = headerGroups.length - 1;\n  const leafGroup = headerGroups[maxDepth];\n\n  headerGroup.headers.forEach((header, position) => {\n    const { placeholderOf } = header;\n\n    const isPlaceholderHeader = placeholderOf != null;\n    if (isPlaceholderHeader) {\n      // is placeholder header\n      const leafIndex =\n        leafGroup.headers\n          .slice(position)\n          .findIndex(({ id }) => id === placeholderOf.id) + position;\n\n      // store leaf placeholder header\n      header.variant = placeholderOf.variant;\n      header.depth = maxDepth;\n      leafGroup.headers[leafIndex] = header;\n\n      // replace placeholder with leaf header\n      placeholderOf.rowSpan = maxDepth + 1;\n      headerGroup.headers[position] = placeholderOf;\n    }\n  });\n};\n\nconst getCellProps = (column, isHeaderCell = false) => ({\n  groupColumnMostLeft: column.isGroupLeftColumn,\n  groupColumnMostRight: column.isGroupRightColumn,\n  rowSpan: isHeaderCell && column.rowSpan != null ? column.rowSpan : 1,\n});\n\n// props target: <table><thead><tr><th>\nconst getHeaderPropsHook = (props, { instance, column }) => {\n  const nextProps: UseHvHeaderGroupsColumnProps = instance.hasGroupedColumns\n    ? getCellProps(column, true)\n    : {};\n\n  if (instance.hasGroupedColumns) {\n    const isPlaceholder = column.placeholderOf != null;\n\n    nextProps.style = {\n      display: isPlaceholder ? \"none\" : props.style?.display,\n    };\n\n    if (instance.hasStickyColumns) {\n      if (isPlaceholder) {\n        nextProps.style.visibility = \"hidden\";\n      }\n\n      if (column.rowSpan > 1) {\n        // rowSpan doesn't work with flex, so we need to simulate it by adjusting the height value manually\n        nextProps.style.height = `calc(var(--first-row-cell-height) + var(--cell-height) * ${\n          column.rowSpan - 1\n        })`;\n      }\n    }\n  }\n\n  return [props, nextProps];\n};\n\n// props target: <table><tbody><tr><td>\nconst getCellPropsHook = (props, { instance, cell }) => {\n  const nextProps: UseHvHeaderGroupsCellProps = instance.hasGroupedColumns\n    ? getCellProps(cell.column)\n    : {};\n\n  return [props, nextProps];\n};\n\nconst visibleColumnsHook = (visibleColumns, { instance }) => {\n  const parentList = new Set();\n\n  visibleColumns.forEach(({ parent }) => {\n    if (parent != null && !parentList.has(parent)) {\n      parentList.add(parent);\n    }\n  });\n\n  const hasGroupedColumns = parentList.size > 0;\n  if (hasGroupedColumns) {\n    parentList.forEach((parent: any) => {\n      parent.align = \"center\";\n      parent.isGroupLeftColumn = true;\n      parent.isGroupRightColumn = true;\n\n      const { columns } = parent;\n      columns[0].isGroupLeftColumn = true;\n      columns[columns.length - 1].isGroupRightColumn = true;\n    });\n  }\n\n  Object.assign(instance, { hasGroupedColumns });\n\n  return visibleColumns;\n};\n\nconst useInstanceHook = (instance) => {\n  if (instance.hasGroupedColumns) {\n    replaceHeaderPlaceholders(instance.headerGroups);\n  }\n};\n\nconst useHeaderGroups: UseHvHeaderGroupsProps = (hooks) => {\n  hooks.visibleColumns.push(visibleColumnsHook);\n  hooks.useInstance.push(useInstanceHook);\n\n  // props target: <table><thead><tr><th>\n  hooks.getHeaderProps.push(getHeaderPropsHook);\n  // props target: <table><tbody><tr><td>\n  hooks.getCellProps.push(getCellPropsHook);\n};\n\nuseHeaderGroups.pluginName = \"useHvHeaderGroups\";\n\nexport default useHeaderGroups;\n"],"names":[],"mappings":"AAwCA,MAAM,4BAA4B,CAAC,iBAAiB;AAC5C,QAAA,CAAC,WAAW,IAAI;AAEhB,QAAA,wBAAwB,YAAY,QAAQ;AAAA,IAChD,CAAC,MAAM,EAAE,iBAAiB;AAAA,EAAA;AAE5B,MAAI,CAAC,uBAAuB;AAC1B;AAAA,EACF;AAEM,QAAA,WAAW,aAAa,SAAS;AACjC,QAAA,YAAY,aAAa,QAAQ;AAEvC,cAAY,QAAQ,QAAQ,CAAC,QAAQ,aAAa;AAC1C,UAAA,EAAE,cAAkB,IAAA;AAE1B,UAAM,sBAAsB,iBAAiB;AAC7C,QAAI,qBAAqB;AAEvB,YAAM,YACJ,UAAU,QACP,MAAM,QAAQ,EACd,UAAU,CAAC,EAAE,GAAG,MAAM,OAAO,cAAc,EAAE,IAAI;AAGtD,aAAO,UAAU,cAAc;AAC/B,aAAO,QAAQ;AACL,gBAAA,QAAQ,SAAS,IAAI;AAG/B,oBAAc,UAAU,WAAW;AACvB,kBAAA,QAAQ,QAAQ,IAAI;AAAA,IAClC;AAAA,EAAA,CACD;AACH;AAEA,MAAM,eAAe,CAAC,QAAQ,eAAe,WAAW;AAAA,EACtD,qBAAqB,OAAO;AAAA,EAC5B,sBAAsB,OAAO;AAAA,EAC7B,SAAS,gBAAgB,OAAO,WAAW,OAAO,OAAO,UAAU;AACrE;AAGA,MAAM,qBAAqB,CAAC,OAAO,EAAE,UAAU,aAAa;AAC1D,QAAM,YAA0C,SAAS,oBACrD,aAAa,QAAQ,IAAI,IACzB;AAEJ,MAAI,SAAS,mBAAmB;AACxB,UAAA,gBAAgB,OAAO,iBAAiB;AAE9C,cAAU,QAAQ;AAAA,MAChB,SAAS,gBAAgB,SAAS,MAAM,OAAO;AAAA,IAAA;AAGjD,QAAI,SAAS,kBAAkB;AAC7B,UAAI,eAAe;AACjB,kBAAU,MAAM,aAAa;AAAA,MAC/B;AAEI,UAAA,OAAO,UAAU,GAAG;AAEtB,kBAAU,MAAM,SAAS,4DACvB,OAAO,UAAU,CACnB;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEO,SAAA,CAAC,OAAO,SAAS;AAC1B;AAGA,MAAM,mBAAmB,CAAC,OAAO,EAAE,UAAU,WAAW;AACtD,QAAM,YAAwC,SAAS,oBACnD,aAAa,KAAK,MAAM,IACxB;AAEG,SAAA,CAAC,OAAO,SAAS;AAC1B;AAEA,MAAM,qBAAqB,CAAC,gBAAgB,EAAE,eAAe;AACrD,QAAA,iCAAiB;AAEvB,iBAAe,QAAQ,CAAC,EAAE,aAAa;AACrC,QAAI,UAAU,QAAQ,CAAC,WAAW,IAAI,MAAM,GAAG;AAC7C,iBAAW,IAAI,MAAM;AAAA,IACvB;AAAA,EAAA,CACD;AAEK,QAAA,oBAAoB,WAAW,OAAO;AAC5C,MAAI,mBAAmB;AACV,eAAA,QAAQ,CAAC,WAAgB;AAClC,aAAO,QAAQ;AACf,aAAO,oBAAoB;AAC3B,aAAO,qBAAqB;AAEtB,YAAA,EAAE,QAAY,IAAA;AACZ,cAAA,CAAC,EAAE,oBAAoB;AAC/B,cAAQ,QAAQ,SAAS,CAAC,EAAE,qBAAqB;AAAA,IAAA,CAClD;AAAA,EACH;AAEA,SAAO,OAAO,UAAU,EAAE,kBAAmB,CAAA;AAEtC,SAAA;AACT;AAEA,MAAM,kBAAkB,CAAC,aAAa;AACpC,MAAI,SAAS,mBAAmB;AAC9B,8BAA0B,SAAS,YAAY;AAAA,EACjD;AACF;AAEA,MAAM,kBAA0C,CAAC,UAAU;AACnD,QAAA,eAAe,KAAK,kBAAkB;AACtC,QAAA,YAAY,KAAK,eAAe;AAGhC,QAAA,eAAe,KAAK,kBAAkB;AAEtC,QAAA,aAAa,KAAK,gBAAgB;AAC1C;AAEA,gBAAgB,aAAa;AAE7B,MAAA,oBAAe;"}