{"version":3,"file":"formatUtils.cjs","sources":["../../../src/TimeAgo/formatUtils.ts"],"sourcesContent":["import dayjs from \"dayjs\";\nimport calendar from \"dayjs/plugin/calendar\";\nimport duration from \"dayjs/plugin/duration\";\nimport localeData from \"dayjs/plugin/localeData\";\nimport localizedFormat from \"dayjs/plugin/localizedFormat\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\nimport updateLocale from \"dayjs/plugin/updateLocale\";\n\n/**\n * Relative time thresholds defined by\n * {@link https://xd.adobe.com/view/1b7df235-5cf8-4b51-a2f0-0be1bb591c55-4e2e/ Design System}\n *\n * Implementation using day.js {@link https://day.js.org/docs/en/customization/relative-time relativeTime}\n */\nconst thresholds = [\n  { l: \"s\", r: 119, d: \"second\" },\n  { l: \"m\", r: 1 },\n  { l: \"mm\", r: 59, d: \"minute\" },\n  { l: \"h\", r: 1 },\n  { l: \"hh\", r: 23, d: \"hour\" },\n  { l: \"d\", r: 1 },\n  { l: \"dd\", r: 29, d: \"day\" },\n  { l: \"M\", r: 1 },\n  { l: \"MM\", r: 11, d: \"month\" },\n  { l: \"y\", r: 17 },\n  { l: \"yy\", d: \"year\" },\n];\n\ndayjs.extend(localeData);\ndayjs.extend(duration);\ndayjs.extend(calendar);\ndayjs.extend(localizedFormat);\ndayjs.extend(relativeTime, { thresholds });\ndayjs.extend(updateLocale);\n\nexport const secondsUntilNextDay = (date = new Date()) => {\n  const midnight = new Date(date.getTime());\n\n  midnight.setDate(midnight.getDate() + 1);\n  midnight.setHours(0);\n  midnight.setMinutes(0);\n  midnight.setSeconds(0);\n  midnight.setMilliseconds(0);\n\n  return (midnight.getTime() - date.getTime()) / 1000;\n};\n\nconst secondsUntilNextWeek = (date = new Date()) => {\n  const firstMonthDayOfWeek = date.getDate() - date.getDay();\n  const firstMonthDayOfNextWeek = firstMonthDayOfWeek + 7; // auto roll over to next month if needed\n\n  const firstDayNextWeek = new Date(date.getTime());\n\n  firstDayNextWeek.setDate(firstMonthDayOfNextWeek);\n  firstDayNextWeek.setHours(0);\n  firstDayNextWeek.setMinutes(0);\n  firstDayNextWeek.setSeconds(0);\n  firstDayNextWeek.setMilliseconds(0);\n\n  return (firstDayNextWeek.getTime() - date.getTime()) / 1000;\n};\n\n/**\n * @typedef {Object} TimeAgo\n * @property {string} timeAgo - the formatted date using the \"time ago format\"\n * @property {number} delay - the time until the date needs to be updated\n */\n\n/**\n * Formats a date to the a relative time format using dayjs.\n *\n * @param {Date} date - date to format.\n * @param {String} locale - locale to use.\n * @param {Boolean} [showSeconds=false] - if seconds should be part of the result.\n * @param {Date} referenceDate - reference date to use when formatting (defaults to current date).\n *\n * @return {TimeAgo} the formatted date using the \"time ago format\" and the time until it needs to be updated\n */\nexport const formatTimeAgo = (\n  date: Date,\n  locale: string,\n  showSeconds = false,\n  referenceDate = new Date()\n) => {\n  const dayReferenceDate = dayjs(referenceDate);\n  const dayDate = dayjs(date).locale(locale);\n\n  const dayDiffSeconds = dayReferenceDate.diff(dayDate, \"second\");\n\n  const formatUseSeconds = showSeconds ? \"LTS\" : \"LT\";\n\n  // check if the date is after the reference date\n  if (date.getTime() > referenceDate.getTime()) {\n    return {\n      timeAgo: dayDate.format(`L ${formatUseSeconds}`),\n      delay: (date.getTime() - referenceDate.getTime()) / 1000,\n    };\n  }\n\n  // just now, until the 2 minutes\n  if (dayDiffSeconds < 120) {\n    return {\n      timeAgo: dayjs\n        .duration(dayDiffSeconds, \"second\")\n        .locale(locale)\n        .humanize(),\n      delay: 120 - dayDiffSeconds,\n    };\n  }\n\n  // ago in minutes, until the 1 hour mark\n  const dayDiffMinutes = dayReferenceDate.diff(dayDate, \"minute\");\n\n  if (dayDiffMinutes < 60) {\n    return {\n      timeAgo: dayjs\n        .duration(-dayDiffMinutes, \"minute\")\n        .locale(locale)\n        .humanize(true),\n      delay: 60 * (dayDiffMinutes + 1) - dayDiffSeconds,\n    };\n  }\n\n  // formatted date with text description for today\n  if (dayReferenceDate.isSame(dayDate, \"day\")) {\n    return {\n      timeAgo: `${dayDate.calendar(dayReferenceDate)}`,\n      delay: secondsUntilNextDay(referenceDate),\n    };\n  }\n\n  // formatted date with text description for yesterday\n  if (dayReferenceDate.subtract(1, \"day\").isSame(dayDate, \"day\")) {\n    return {\n      timeAgo: `${dayDate.calendar(dayReferenceDate)}`,\n      delay: secondsUntilNextDay(referenceDate),\n    };\n  }\n\n  // formatted date with week during the current week\n  if (dayDate.isSame(dayReferenceDate, \"week\")) {\n    return {\n      timeAgo: dayDate.format(`ddd, ${formatUseSeconds}`),\n      delay: secondsUntilNextWeek(date),\n    };\n  }\n\n  // formatted without special gimmicks\n  return {\n    timeAgo: dayDate.format(`L ${formatUseSeconds}`),\n    delay: 0,\n  };\n};\n"],"names":["dayjs","localeData","duration","calendar","localizedFormat","relativeTime","updateLocale"],"mappings":"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"}